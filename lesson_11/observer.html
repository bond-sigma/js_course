<!DOCTYPE html>
<html>
<head>
    <title></title>
</head>
<body>
<script type="text/javascript">

    var publisher = {

        subscribers     : {
            any: []                // тип события: подписчик
        },
        subscribe       : function (fn, type) {
            type = type || 'any';
            if (typeof this.subscribers[type] === "undefined") {
                this.subscribers[type] = [];
            }
            this.subscribers[type].push(fn);
        },
        unsubscribe     : function (fn, type) {
            this.visitSubscribers('unsubscribe', fn, type);
        },
        publish         : function (publication, type) {
            this.visitSubscribers('publish', publication, type);
        },
        visitSubscribers: function (action, arg, type) {
            var pubtype = type || 'any',
                    subscribers = this.subscribers[pubtype],
                    i,
                    max = subscribers.length;
            for (i = 0; i < max; i += 1) {
                if (action === 'publish') {
                    subscribers[i](arg);
                } else {
                    if (subscribers[i] === arg) {
                        subscribers.splice(i, 1);
                    }
                }
            }
        }
    };


    function makePublisher(o) {
        var i;
        for (i in publisher) {
            if (publisher.hasOwnProperty(i) && typeof publisher[i] === "function") {
                o[i] = publisher[i];
            }
        }
        o.subscribers = {any: []};
    }

    var paper = {
        daily: function () {
            this.publish("big news today");
        },
        monthly: function () {
            this.publish("interesting analysis", "monthly");
        }
    };

    makePublisher(paper);


    var joe = {
        drinkCoffee: function (paper) {
            console.log('Just read ' + paper);
        },
        sundayPreNap: function (monthly) {
            console.log('About to fall asleep reading this ' + monthly);
        } };



    paper.subscribe(joe.drinkCoffee);
    paper.subscribe(joe.sundayPreNap, 'monthly');


    paper.daily();
    paper.daily();
    paper.daily();
    paper.monthly();


    /**
     * Создаем класс от которого будут наследоватся чтобы реализовывать интерфейс Наблюдатель
     * @constructor
     */
    function EventEmitter() {
        //каждый екземпляр должен иметь свой список событий поэтому помещаем это свойство в конструктор
        this.events = [];
    }

    EventEmitter.prototype = {
        constructor: EventEmitter,
        //метод добавления обработчика на событие. Аналогичен подписке на события в jquery
        /**
         *
         * @param eventName Имя события
         * @param callback функция обработчик на событие
         * @param context Контекст для this в котором вызывать это событие
         */
        on         : function (eventName, callback, context) {

            //если подписчиков для такого события еще не было создаем массив для подписчиков
            if (typeof this.events[eventName] === "undefined") {
                this.events[eventName] = [];
            }

            //добавляем обработчик в массив для для данного события
            this.events[eventName].push({
                fn     : callback,
                context: context || this
            });
        },
        //Удаление обработчиков для определенного события
        off        : function (eventName) {
            if (this.events[eventName]) {
                this.events[eventName] = [];
            }
        },
        //Вызвать событие с таким именем
        fireEvent  : function (eventName) {
            // Превращаем все аргументы переданные в функцию в массив и вырезаем имя события
            var args = Array.prototype.slice.apply(arguments, [1]);

            //Вызываем все обработчики для события с массивом аргументов
            if (this.events[eventName]) {
                for (var i = 0; i < this.events[eventName].length; i++) {
                    this.events[eventName][i].fn.apply(this.events[eventName][i].context, args);
                }
            }
        }
    };

    /**
     * Объявляем класс и наследуем через заимствование конструктора от EventEmitter
     * @constructor
     */
    function Car()
    {
        this.name = 'Honda';
        this.start = function () {
            //Вызываем событие с аргументами 1,2,3,4 которые будут переданы в в обработчики
            this.fireEvent('car:started',1 , 2, 3, 4);
        };
        EventEmitter.apply(this);
    }

    //Наследуем методы
    Car.prototype = EventEmitter.prototype;

    function Driver() {
        this.press = function () {
            console.log('Pressed');
        }
    }

    var car1 = new Car();
    var driver1 = new Driver();

    //Подписываемся на событие старта двигателя у самой машины
    car1.on('car:started', function () {
        console.log(arguments)
        this.press();
    }, driver1);

    car1.start();


</script>
</body>
</html>